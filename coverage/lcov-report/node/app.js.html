<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node/app.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\prettify.css" />
    <link rel="stylesheet" href="..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\index.html">All files</a> / <a href="index.html">node</a> app.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">58.9% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>129/219</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">55.26% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>42/76</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">46.67% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>7/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">58.53% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>127/217</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">require('es6-promise').polyfill();
require('isomorphic-fetch');
&nbsp;
const
  bodyParser = require('body-parser'),
  crypto = require('crypto'),
  express = require('express'),
  https = require('https'),
  request = require('request'),
  createButton = require('./create_button'),
  utillArray = require('./utill_array'),
  firebase = require('./firebase'),
  tunnelConfig = require('./tunnel.json'),
  summary = require('./summary'),
  userClass = require('./models/user'),
  resultFirebase = require('./result'),
  api = require('./localUserAPI'),
  messenger = require('./messenger'),
  config = require('./config')
&nbsp;
&nbsp;
let APP_SECRET, VALIDATION_TOKEN, PAGE_ACCESS_TOKEN, SERVER_URL
&nbsp;
APP_SECRET = config.APP_SECRET
VALIDATION_TOKEN = config.VALIDATION_TOKEN
PAGE_ACCESS_TOKEN = config.PAGE_ACCESS_TOKEN
SERVER_URL = config.SERVER_URL
&nbsp;
/**
 * this is Main messenger app .
 */
&nbsp;
const app = <span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {
  // config.serverURL = tunnelConfig.serverURL
  // console.log("config ", config, tunnelConfig)
&nbsp;
  let app = <span class="cstat-no" title="statement not covered" >express()</span>
<span class="cstat-no" title="statement not covered" >  app.set('port', process.env.PORT || 4000)</span>
<span class="cstat-no" title="statement not covered" >  app.set('view engine', 'ejs')</span>
<span class="cstat-no" title="statement not covered" >  app.use(bodyParser.json({ extended: false }))</span>
<span class="cstat-no" title="statement not covered" >  app.use(express.static('public'))</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  app.get('/webhook', <span class="fstat-no" title="function not covered" >(r</span>eq, res) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >    if (req.query['hub.mode'] === 'subscribe' &amp;&amp;</span>
      req.query['hub.verify_token'] === VALIDATION_TOKEN) {
<span class="cstat-no" title="statement not covered" >      console.log("Validating webhook")</span>
<span class="cstat-no" title="statement not covered" >      res.status(200).send(req.query['hub.challenge'])</span>
    } else {
<span class="cstat-no" title="statement not covered" >      console.error("Failed validation. Make sure the validation tokens match.")</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      res.sendStatus(403)</span>
    }
  });
&nbsp;
&nbsp;
  //occur when user send something to bot
<span class="cstat-no" title="statement not covered" >  app.post('/webhook', <span class="fstat-no" title="function not covered" >(r</span>eq, res) =&gt; {</span>
&nbsp;
    let data = <span class="cstat-no" title="statement not covered" >req.body</span>
    // Make sure this is a page subscription
<span class="cstat-no" title="statement not covered" >    if (data.object == 'page') {</span>
      // Iterate over each entry
      // There may be multiple if batched
<span class="cstat-no" title="statement not covered" >      data.entry.forEach(<span class="fstat-no" title="function not covered" >pa</span>geEntry =&gt; {</span>
        let pageID = <span class="cstat-no" title="statement not covered" >pageEntry.id</span>
        let timeOfEvent = <span class="cstat-no" title="statement not covered" >pageEntry.time</span>
&nbsp;
        // Iterate over each messaging event
<span class="cstat-no" title="statement not covered" >        pageEntry.messaging.forEach(<span class="fstat-no" title="function not covered" >as</span>ync messagingEvent =&gt; {</span>
<span class="cstat-no" title="statement not covered" >          console.log("recieve mssg read")</span>
<span class="cstat-no" title="statement not covered" >          console.log("mssg.read ", messagingEvent.read)</span>
<span class="cstat-no" title="statement not covered" >          console.log("receive mssg")</span>
&nbsp;
          //get all question keys and save to usersData for that senderID
          let keysLeftForThatUser = <span class="cstat-no" title="statement not covered" >await getKeys()</span>
          // get user if doesn't have this user before
          let user = <span class="cstat-no" title="statement not covered" >await userClass.load(messagingEvent.sender.id, keysLeftForThatUser, api)</span>
&nbsp;
&nbsp;
<span class="cstat-no" title="statement not covered" >          if (messagingEvent.optin) {</span>
<span class="cstat-no" title="statement not covered" >            receivedAuthentication(messagingEvent)</span>
          } else <span class="cstat-no" title="statement not covered" >if (messagingEvent.message) {</span>
<span class="cstat-no" title="statement not covered" >            receivedMessage(messagingEvent, user)</span>
          } else <span class="cstat-no" title="statement not covered" >if (messagingEvent.delivery) {</span>
<span class="cstat-no" title="statement not covered" >            receivedDeliveryConfirmation(messagingEvent);</span>
          } else <span class="cstat-no" title="statement not covered" >if (messagingEvent.postback) {</span>
<span class="cstat-no" title="statement not covered" >            receivedPostback(messagingEvent, user)</span>
          } else <span class="cstat-no" title="statement not covered" >if (messagingEvent.read) {</span>
<span class="cstat-no" title="statement not covered" >            receivedMessageRead(messagingEvent)</span>
          } else <span class="cstat-no" title="statement not covered" >if (messagingEvent.account_linking) {</span>
<span class="cstat-no" title="statement not covered" >            receivedAccountLink(messagingEvent)</span>
          } else {
<span class="cstat-no" title="statement not covered" >            console.log("Webhook received unknown messagingEvent: ", messagingEvent)</span>
          }
        });
      });
&nbsp;
      // Assume all went well.
      //
      // You must send back a 200, within 20 seconds, to let us know you've 
      // successfully received the callback. Otherwise, the request will time out.
<span class="cstat-no" title="statement not covered" >      res.sendStatus(200)</span>
    }
  });
&nbsp;
  /*
   * Message Event
   *
   * This event is called when a message is sent to your page. The 'message' 
   * object format can vary depending on the kind of message that was received.
   * Read more at https://developers.facebook.com/docs/messenger-platform/webhook-reference/message-received
   *
   * For this example, we're going to echo any text that we get. If we get some 
   * special keywords ('button', 'generic', 'receipt'), then we'll send back
   * examples of those bubbles to illustrate the special message bubbles we've 
   * created. If we receive a message with an attachment (image, video, audio), 
   * then we'll simply confirm that we've received the attachment.
   * 
   */
  async function <span class="fstat-no" title="function not covered" >receivedMessage(</span>event, user) {
    let senderID = <span class="cstat-no" title="statement not covered" >event.sender.id</span>
    let recipientID = <span class="cstat-no" title="statement not covered" >event.recipient.id</span>
    let timeOfMessage = <span class="cstat-no" title="statement not covered" >event.timestamp</span>
    let message = <span class="cstat-no" title="statement not covered" >event.message</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    console.log("Received message for user %d and page %d at %d with message:",</span>
      senderID, recipientID, timeOfMessage)
<span class="cstat-no" title="statement not covered" >    console.log(JSON.stringify(message))</span>
&nbsp;
    let isEcho = <span class="cstat-no" title="statement not covered" >message.is_echo</span>
    let messageId = <span class="cstat-no" title="statement not covered" >message.mid</span>
    let appId = <span class="cstat-no" title="statement not covered" >message.app_id</span>
    let metadata = <span class="cstat-no" title="statement not covered" >message.metadata</span>
&nbsp;
    // You may get a text or attachment but not both
    let messageText = <span class="cstat-no" title="statement not covered" >message.text</span>
    let messageAttachments = <span class="cstat-no" title="statement not covered" >message.attachments</span>
    let quickReply = <span class="cstat-no" title="statement not covered" >message.quick_reply</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (messageText) {</span>
<span class="cstat-no" title="statement not covered" >      handleReceivedMessage(user, messageText)</span>
    } else <span class="cstat-no" title="statement not covered" >if (messageAttachments) {</span>
<span class="cstat-no" title="statement not covered" >      messenger.sendTextMessage(senderID, "Message with attachment received")</span>
    }
  }
&nbsp;
  /*
   * Postback Event
   *
   * This event is called when a postback is tapped on a Structured Message. 
   * https://developers.facebook.com/docs/messenger-platform/webhook-reference/postback-received
   * 
   */
  async function <span class="fstat-no" title="function not covered" >receivedPostback(</span>event, user) {
    let senderID = <span class="cstat-no" title="statement not covered" >event.sender.id</span>
    let recipientID = <span class="cstat-no" title="statement not covered" >event.recipient.id</span>
    let timeOfPostback = <span class="cstat-no" title="statement not covered" >event.timestamp</span>
    // The 'payload' param is a developer-defined field which is set in a postback 
    // button for Structured Messages. 
    let payload = <span class="cstat-no" title="statement not covered" >event.postback.payload</span>
    let payloadObj = <span class="cstat-no" title="statement not covered" >JSON.parse(payload)</span>
<span class="cstat-no" title="statement not covered" >    console.log("Received postback for user %d and page %d with payload '%s' " +</span>
      "at %d", senderID, recipientID, payload, timeOfPostback)
&nbsp;
<span class="cstat-no" title="statement not covered" >    handleReceivedPostback(user, payloadObj, timeOfPostback)</span>
  }
&nbsp;
&nbsp;
  // Start server
  // Webhooks must be available via SSL with a certificate signed by a valid 
  // certificate authority.
<span class="cstat-no" title="statement not covered" >  app.listen(app.get('port'), <span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >    console.log('Node app is running on port', app.get('port'))</span>
<span class="cstat-no" title="statement not covered" >    messenger.setGreetingText()</span>
  })
}
&nbsp;
&nbsp;
let answerForEachQuestion
let startedAt
&nbsp;
&nbsp;
async function getKeys(category) {
  let keys
  <span class="missing-if-branch" title="else path not taken" >E</span>if(!category) keys = await firebase.getAllQuestionKeys()
  else <span class="cstat-no" title="statement not covered" >keys = await firebase.getAllQuestionKeys(category)</span>
  return keys
}
&nbsp;
&nbsp;
const handleReceivedMessage = async (user, messageText) =&gt; {
  if (messageText !== "OK" &amp;&amp; user.state.welcomed === true &amp;&amp; user.state.state !== "pause" &amp;&amp; user.state.state !== "finish") {
    messenger.sendTextMessage(user.senderID, "บอกให้พิมพ์ OK ไง เมี๊ยว")
  }
  // //other users except the first user will add their profile to firebase
  else {
    let userDetail = await messenger.getUserDetail(user.senderID)
    let firstName = userDetail.first_name
    firebase.saveUserToFirebase(user.senderID, userDetail)
&nbsp;
    if (user.state.welcomed === false) {
      user.welcome()
      console.log("user set welcome = ", user)
      // user.playing()
      user.choosing()
      console.log("user set choosing = ", user)
      messenger.sendTextMessage(user.senderID, `Welcome to QuizBot! ${firstName}` + "\n" + `say 'OK' if you want to play`)
    }
&nbsp;
    // //already quiz with chatbot or user come back after pause
    else if (user.state.state === "playing" || user.state.state === "pause") {
      console.log("playing")
      console.log("user playing = ", user)
&nbsp;
      let keysLeftForThatUser = await firebase.getAllQuestionKeys(user.state.category)
      user.hasKeysLeft(keysLeftForThatUser)
      //get keys question that user done
      let keysDone = await firebase.getQuestionDone(user.senderID, user.state.round, user.state.category)
&nbsp;
      //remove questions done from questions that not yet answered
      user.removeKeysDone(keysDone)
&nbsp;
&nbsp;
      //if user pause -&gt; change to playing
      <span class="missing-if-branch" title="if path not taken" >I</span>if (user.state.state === "pause") {
<span class="cstat-no" title="statement not covered" >        console.log("_________PAUSE__________")</span>
<span class="cstat-no" title="statement not covered" >        user.resume()</span>
<span class="cstat-no" title="statement not covered" >        console.log("user after resume = ", user)</span>
      }
      // else if (user.state.state === "finish") {
      //   let keysLeftForThatUser = await firebase.getAllQuestionKeys(user.state.category)
      //   //change state to playing
      //   user.nextRound(keysLeftForThatUser)
      // }
&nbsp;
      // //shuffle keys of questions that have not answered
      let shuffledKey = utillArray.shuffleKeyFromQuestions(user.state.keysLeftForThatUser)
      user.startQuiz(shuffledKey)
      console.log("user start quiz = ", user)
      answerForEachQuestion = await firebase.getAllAnswersFromQuestion(shuffledKey)
      if (answerForEachQuestion == null) {
        console.log("Doesn't have this id in questions database")
        return null
      }
      // //create button for that question
      const buttonsCreated = await createButton.createButtonFromQuestionId(shuffledKey)
      const buttonMessage = await createButton.createButtonMessageWithButtons(user.senderID, buttonsCreated)
      startedAt = utillArray.getMoment()
      messenger.callSendAPI(buttonMessage)
&nbsp;
    }
    else if(user.state.state === "finish"){
      let buttonCat = createButton.createButtonCategory(user.senderID)
      messenger.callSendAPI(buttonCat)
    }
    else <span class="missing-if-branch" title="else path not taken" >E</span>if (user.state.state === "choosing") {
      let buttonCat = await createButton.createButtonCategory(user.senderID)
      messenger.callSendAPI(buttonCat)
    }
  } 
}
&nbsp;
&nbsp;
async function handleReceivedPostback(user, payloadObj, timeOfPostback) {
  let numberOfQuestions = await firebase.getNumberOfQuestions(user.state.category)
&nbsp;
  //check for button nextRound payload
  if (payloadObj.nextRound === true) {
    messenger.sendTextMessage(user.senderID, "Next Round!")
    let buttonCat = await createButton.createButtonCategory(user.senderID)
    messenger.callSendAPI(buttonCat)
    // startNextRound(user)
  }
  else if (payloadObj.nextRound === false) {
    //finish
    user.finish()
    messenger.sendTextMessage(user.senderID, "Come back when you're ready~")
    messenger.sendTextMessage(user.senderID, "Bye Bye &lt;3")
  }
&nbsp;
  //check for button next question
  else if (payloadObj.nextQuestion === true) {
    //call next question
    nextQuestion(user)
  }
  else if (payloadObj.nextQuestion === false) {
    //pause
    user.pause()
    messenger.sendTextMessage(user.senderID, "Hell &lt;3")
    messenger.sendTextMessage(user.senderID, "Come back when you're ready~")
  }
  //choose category of questions
  else if (payloadObj.category === "12 factors app") {
    user.playing()
    user.chooseCategory(payloadObj.category)
    messenger.sendTextMessage(user.senderID, `Alright, say 'OK' if you are ready to play`)
  }
  else if (payloadObj.category === "design patterns") {
    user.playing()
    user.chooseCategory(payloadObj.category)
    messenger.sendTextMessage(user.senderID, `Alright, say 'OK' if you are ready to play`)
  }
&nbsp;
  //Postback for normal questions
  else {
    //if in playing question state when receive postback 
    //number of questions that user already done increase
    <span class="missing-if-branch" title="else path not taken" >E</span>if (user.state.state === "playing") {
      user.doneQuestion()
    }
    console.log("user after done question= ", user)
&nbsp;
    // //check answer and ask next question
    let result = checkAnswer(payloadObj, answerForEachQuestion)
&nbsp;
    //send to calculate grade and score for summary
    let duration = <span class="cstat-no" title="statement not covered" >utillArray.calculateDuration(startedAt, timeOfPostback)</span>
    let totalScore = <span class="cstat-no" title="statement not covered" >summary.calculateTotalScore(numberOfQuestions)</span>
    let scoreOfThatQuestion = <span class="cstat-no" title="statement not covered" >summary.calculateScoreForThatQuestion(payloadObj.point, result, duration) </span>//point for that question 
<span class="cstat-no" title="statement not covered" >    user.state.userScore += scoreOfThatQuestion</span>
    let grade = <span class="cstat-no" title="statement not covered" >summary.calculateGrade(totalScore, user.state.userScore)</span>
&nbsp;
    // // answer Correct
<span class="cstat-no" title="statement not covered" >    if (result) {</span>
<span class="cstat-no" title="statement not covered" >      messenger.sendTextMessage(user.senderID, "Good dog!")</span>
      let preparedResult = <span class="cstat-no" title="statement not covered" >await resultFirebase.prepareResultForFirebase(payloadObj, answerForEachQuestion, user.state.round,</span>
        result, startedAt, timeOfPostback, scoreOfThatQuestion, user.senderID, user.state.category)
<span class="cstat-no" title="statement not covered" >      firebase.saveResultToFirebase(user.senderID, preparedResult)</span>
    }
    //answer Wrong
    else {
<span class="cstat-no" title="statement not covered" >      messenger.sendTextMessage(user.senderID, "Bad dog!")</span>
      let preparedResult = <span class="cstat-no" title="statement not covered" >await resultFirebase.prepareResultForFirebase(payloadObj, answerForEachQuestion, user.state.round,</span>
        result, startedAt, timeOfPostback, scoreOfThatQuestion, user.senderID, user.state.category)
<span class="cstat-no" title="statement not covered" >      firebase.saveResultToFirebase(user.senderID, preparedResult)</span>
    }
&nbsp;
    let keysDone = <span class="cstat-no" title="statement not covered" >await firebase.getQuestionDone(user.senderID, user.state.round, user.state.category)</span>
<span class="cstat-no" title="statement not covered" >    user.removeKeysDone(keysDone)</span>
    //prepare summary object to save in firebase
    let preparedSummary = <span class="cstat-no" title="statement not covered" >summary.prepareSummary(user.state.done, numberOfQuestions, user.state.keysLeftForThatUser,</span>
      user.state.round, user.state.category, grade, user.state.userScore, totalScore)
<span class="cstat-no" title="statement not covered" >    firebase.saveSummaryToFirebase(user.senderID, preparedSummary)</span>
<span class="cstat-no" title="statement not covered" >    console.log("_______keysLeftForThatUser______ = ", user.state.keysLeftForThatUser)</span>
    let keysLeftForThatUser = <span class="cstat-no" title="statement not covered" >user.state.keysLeftForThatUser</span>
&nbsp;
&nbsp;
    //ask whether user ready to play next question 
    //if there are still questions left that have not done =&gt; create next button
<span class="cstat-no" title="statement not covered" >    if (typeof keysLeftForThatUser !== 'undefined' &amp;&amp; keysLeftForThatUser.length &gt; 0) {</span>
      let buttonNext = <span class="cstat-no" title="statement not covered" >await createButton.createButtonNext(user.senderID)</span>
<span class="cstat-no" title="statement not covered" >      messenger.callSendAPI(buttonNext)</span>
    }
    //if there is no question left that have not done =&gt; create next round button
    else {
<span class="cstat-no" title="statement not covered" >      nextQuestion(user)</span>
    }
  }
}
&nbsp;
function checkAnswer(payload, answerForEachQuestion) {
  //the correct answer is always in first element of answers in json file
  if (payload.answer == answerForEachQuestion[0]) return true
  else return false
&nbsp;
}
&nbsp;
async function nextQuestion(user) {
  let numberOfQuestions = await firebase.getNumberOfQuestions(user.state.category)
  let done = user.state.done
 
  let keyOfNextQuestion = utillArray.shuffleKeyFromQuestions(user.state.keysLeftForThatUser)
  //no question left
  //finish that round
  if (keyOfNextQuestion == null) {
    let grade = await firebase.getGrade(user.senderID, user.state.round)
    messenger.sendTextMessage(user.senderID, "Finish!")
    messenger.sendTextMessage(user.senderID, `ได้คะแนน ${user.state.userScore} เกรด ${grade} ถ้าอยากรู้ลำดับก็ไปที่ https://quizchatbot-ce222.firebaseapp.com/ เลยย`)
    user.finish()
    nextRound(user, numberOfQuestions, done)
  }
&nbsp;
  //still has questions not answered
  else {
    answerForEachQuestion = await firebase.getAllAnswersFromQuestion(keyOfNextQuestion)
    //no key that matched question
    if (answerForEachQuestion == null) {
      console.log("Doesn't have this id in questions json")
      return null
    }
&nbsp;
    let buttonsCreated = await createButton.createButtonFromQuestionId(keyOfNextQuestion)
    let buttonMessage = await createButton.createButtonMessageWithButtons(user.senderID, buttonsCreated)
&nbsp;
    startedAt = utillArray.getMoment()
&nbsp;
    messenger.callSendAPI(buttonMessage)
  }
}
&nbsp;
//remove array from array
//remove questions'keys that already done 
// const removeKeysDone = (keys, keysDone) =&gt; {
//   utillArray._.pullAll(keys, keysDone)
// }
&nbsp;
const nextRound = (user, numberOfQuestions, done) =&gt; {
  //if number of done questions equals to number of all questions
  //then that round is complete -&gt; round increase 
  let round = user.state.round
  if (done === numberOfQuestions) {
    round++
    user.setRound(round)
  }
  //create button ask for next round
  let buttonMessage = createButton.createButtonNextRound(user.senderID)
  messenger.callSendAPI(buttonMessage)
}
&nbsp;
const startNextRound = async (user) =&gt; {
  //ready to ask question
  let keysLeftForThatUser = await getKeys()
  user.nextRound(keysLeftForThatUser)
&nbsp;
  let shuffledKey = utillArray.shuffleKeyFromQuestions(keysLeftForThatUser)
  answerForEachQuestion = await firebase.getAllAnswersFromQuestion(shuffledKey)
&nbsp;
  if (answerForEachQuestion == null) {
    console.log("Doesn't have this id in questions database")
    return null
  }
&nbsp;
  const buttonsCreated = await createButton.createButtonFromQuestionId(shuffledKey)
  const buttonMessage = await createButton.createButtonMessageWithButtons(user.senderID, buttonsCreated)
  startedAt = utillArray.getMoment()
  messenger.callSendAPI(buttonMessage)
}
&nbsp;
&nbsp;
module.exports = {
  app, handleReceivedMessage, handleReceivedPostback,
  startNextRound, nextRound, nextQuestion, checkAnswer, getKeys
}
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Thu Jul 13 2017 11:23:10 GMT+0700 (SE Asia Standard Time)
</div>
</div>
<script src="..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\sorter.js"></script>
</body>
</html>
